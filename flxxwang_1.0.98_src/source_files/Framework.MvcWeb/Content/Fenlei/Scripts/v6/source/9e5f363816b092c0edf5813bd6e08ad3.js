﻿(function(global,DOC,undefined){
boot.declare('business.user','config, dom, event, extension.array, extension.string, util.cookie, util.js',
function(Namespace,Frame,config,dom,event,array,string,cookie,js){
Namespace.user={
//containerid:"logintext",
//loginurl:'http://passport.flxxwang.com/login/',
//logouturl:'http://my.flxxwang.com/ajax/loginout/',
//simloginurl:'http://my.flxxwang.com/simlogin/?type=ajax&radom=',
isLogin:function(){
var userid=this.get('UserID');
if(Frame.isEmpty(userid))
return false;
try{userid=parseInt(userid);if(userid<=2)return false;else return true}
catch(e){return false
}
},
get:function(name){var cookieValue=cookie.get("www58com",false);
if(!cookieValue)return null;var ms=cookieValue.match(new RegExp(name+"=([^&;]+)"));
if(ms&&ms.length==2){return decodeURIComponent(ms[1])}else{return null}},
login:function(){var self=this;boot.require('widgets.window',function(Frame,win){
win.getInstance().show("登录",self.simloginurl,300,200,true)})},logout:function(){
var self=this;js.jsonp(this.logouturl,null,function(){self.show();
Frame.log('business.user','success','用户成功注销')},function(){
Frame.log('business.user','error','用户注销失败')})},show:function(){
var self=this,container=dom.get(self.containerid),outurl=escape(location.href);if(!container){
Frame.log('business.user','error','找不到父容器');return}
var isNtalker=true;isNtalker=false;if(isNtalker){if(self.isLogin()){
ims_siteid='58';ims_userid=self.get("UserID");ims_username=self.get("UserName");
ims_sessionid=self.get('SiteKey');ims_callback=function(sessionRequestCount){
var emailCount;if(cookie.get('ntalker-msgTips_close')){emailCount=0}else{
emailCount=parseInt(self.get("MsgUnReadTotal"))+parseInt(self.get("SystemUnReadTotal"))+parseInt(self.get("RequireFriendUnReadTotal"))+parseInt(self.get("CommentUnReadTotal"))}var messageCount=sessionRequestCount;if(emailCount>0||messageCount>0){var str='<i class="msgTips_arrow"></i><em id="ntalker-msgTips_close" class="msgTips_close"></em><div class="msgTips_con ntTips_con">';if(messageCount>0){str+='<span class="num">{0}</span>条即时消息，<a id="ntalker-msgTips-show" href="http://my.flxxwang.com/index/?menu=0" target="_blank">点击查看</a><br>'}if(emailCount>0){str+='<span class="num">{1}</span>条站内信，<a href="http://my.flxxwang.com/msgrev/0/0/?menu=10" target="_blank">点击查看</a><br>'}str+='</div><i class="shadow"></i>';var element=dom.get('ntalker-msgTips');element.innerHTML=string.format(str,messageCount,emailCount);element.style.display='';event.on('ntalker-msgTips_close','click',function(){dom.hide(element);var now=new Date();var to=new Date(now.getFullYear(),now.getMonth(),now.getDate()+1);cookie.set('ntalker-msgTips_close','true',to)});event.on('ntalker-msgTips-show','click',function(){dom.hide('ntalker-msgTips');__connect&&__connect.clear()})}};js.append((location.search.indexOf('debug=true')!=-1)?'http://downtest.ntalker.com/58/impresence.js':'http://pic2.flxxwang.com/ntalker/res/impresence.js');var tplUserinfo='<span class="user_id">{0}</span>'+'<span class="user_center"><a target="_self" href="http://my.flxxwang.com/">我的58</a></span>'+'<span class="user_ntalker"><div id="ntalker-msgTips" class="msgTips ntTips" style="display:none;"></div></span>';tplUserinfo+='<span class="user_i"><a id="user-logout" target="_self" href="http://passport.flxxwang.com/logout?path={1}&back=now" title="'+(self.get('AutoLogin')=='true'?'安全退出，同时您的自动登录将失效。':'')+'">退出</a></span>';container.innerHTML=string.format(tplUserinfo,self.get("UserName"),outurl);event.on('user-logout','click',function(){cookie.remove('ntalker-msgTips_close')});ims_callback(0)}else{var tplLogin='<a href="http://passport.flxxwang.com/login/?path={0}" target="_self">登录</a>'+'<span class="gap">|</span>'+'<a href="http://passport.flxxwang.com/reg/?city={1}" target="_self">注册</a>';container.innerHTML=string.format(tplLogin,outurl,config.city.listname)}return}else{var loginStr='<a href="http://passport.flxxwang.com/login/?path={0}" target="_self">登录</a><span class="gap">|</span><a href="http://passport.flxxwang.com/reg/" target="_self">注册</a>',userinfoStr='{0}{1}<a href="http://my.flxxwang.com/" target="_self" style="margin:0 10px">我的58</a><a href="http://passport.flxxwang.com/logout?path={2}&back=now" target="_self">退出</a>',messageStr='(<span class="red"><a style="color:#F00;margin: 0px;" href="http://my.flxxwang.com/liuyanjieshou/" title="你有{0}条未读短信息">{0}</a></span>)',host=window.location.hostname,hosthome=host.substr(0,host.indexOf("."));if(!(document.cookie!=null&&document.cookie!=''&&document.cookie!='undefined')){var exp=new Date();exp.setTime(exp.getTime()+30*24*60*60*1000);document.cookie="supportcookie=true;domain=flxxwang.com;expires="+exp.toGMTString();if(!(document.cookie!=null&&document.cookie!=''&&document.cookie!='undefined')){container.innerHTML=string.format(loginStr,outurl,hosthome);return}Frame.log('business.user','waring','客户端禁用cookie，显示未登录状态')}try{if(this.isLogin()){var msgcount=parseInt(this.get("MsgUnReadTotal"))+parseInt(this.get("SystemUnReadTotal"))+parseInt(this.get("RequireFriendUnReadTotal"))+parseInt(this.get("CommentUnReadTotal"));container.innerHTML=string.format(userinfoStr,this.get("UserName"),msgcount>0?string.format(messageStr,msgcount):'',outurl)}else{container.innerHTML=string.format(loginStr,outurl,hosthome)}return}catch(e){container.innerHTML=string.format(loginStr,outurl,hosthome);Frame.log('business.user','error','显示用户信息异常',e)}}}}})})(this,this.document);﻿(function(global,DOC,undefined){boot.declare('widgets.window','dom,event,business.user, extension.string,widgets.box',function(Namespace,Frame,dom,event,user,string,box){var win=Namespace.window=function(title,url,width,height,closeable){this.title=title;this.width=width;this.height=height;this.url=url;this.closeable=!!closeable;win.superclass.constructor.call(this)};win.__win=null;win.getInstance=function(){if(Frame.isEmpty(this.__win)){this.__win=new fe.widgets.window("","",300,200,true)}return this.__win};Frame.extend(win,box,{id:'fe_window_'+Frame.id(),title:null,url:null,width:400,minWidth:300,height:200,minHeight:200,top:0,left:0,closeable:true,mask:null,form:null,_topheight:34,_bottomheight:0,_framepadding:8,_containsarea:null,_frame:null,_toparea:null,_titleid:null,_iframeareaid:null,_loadarea:null,_bottomarea:null,_cssform:'display:none;left:50%;margin:-{0}px 0px 0px -{1}px;'+(Frame.isIE6?'top:expression((document.documentElement.scrollTop || document.body.scrollTop) + Math.round(50 * (document.documentElement.offsetHeight || document.body.clientHeight) / 100));':'top:45%;'),mode:'iframe',modal:true,html:'',init:function(){win.superclass.init.call(this)},createMask:function(){var self=this,mask=dom.create('div',{style:Frame.isIE?"display:none;position:absolute;width:"+screen.width+"px;height:"+screen.height+"px;":"display:none;position:fixed;width:"+screen.width+"px;height:"+screen.height+"px;",className:'fe_window_mask'}),maskIframe=dom.create('iframe',{style:'width:100%;height:100%;background-color:#000;filter:alpha(Opacity=0);opacity:0;'});mask.appendChild(maskIframe);document.body.appendChild(mask);Frame.apply(self,{mask:mask,maskIframe:maskIframe})},createForm:function(){var self=this,form=dom.create('div',{id:self.id+'_form',className:"fe_window",style:string.format(self._cssform,self.height/ 2, self.width /2)}),_outerarea=dom.create("div",{id:self.id+'_outer',className:"outer"}),_frame=dom.create("div",{style:string.format("width: {0}px; height: {1}px; padding: {2}px; ",self.width,self.height,self._framepadding),className:'frame'}),_toparea;if(self._topheight){_toparea=dom.create('div',{className:'topbar',style:string.format("height:{0}px;",self._topheight),childrens:[dom.create('a',{id:self.id+'_closebtn',target:'_self',className:'closebtn',href:'javascript:void(0);',listeners:{click:function(){self.hide()}}}),dom.create("span",{id:self._titleid=self.id+"_title",className:'title',style:self.closeable?'':'display:none',html:self.title||""})]})}var _containsarea=dom.create('div',{style:string.format("width: {0}px; height:{1}px; top: {2}px; left: {2}px; ",self.width-30,self.height,self._framepadding),className:'contains'});var _loadarea=dom.create('div',{className:'load',style:string.format("display:block;height:{0}px;background:zhaopin_files/loading.gif;z-index:9998;",self.height-self._topheight-self._bottomheight),html:'加载中...'});var loadAction=self.id+"_loadAction";window[loadAction]=function(){var _iframearea=dom.get(self._iframeareaid);try{_iframearea.style.cssText=string.format("height:{0}px;width:100%;",self.minHeight-self._topheight-self._bottomheight);var width=Math.max(_iframearea.contentWindow.document.documentElement.scrollWidth,_iframearea.contentWindow.document.body.scrollWidth),height=Math.max(_iframearea.contentWindow.document.documentElement.scrollHeight,_iframearea.contentWindow.document.body.scrollHeight);self.resize(width,height+self._topheight+self._bottomheight)}catch(e){}self.showLoad(false);self.center()};self._iframeareaid=self.id+"_iframe";var strIframe=string.format('<iframe id="{0}" frameborder="0" scrolling="no" style="height: {1}px; width: 100%;" class="fe_window_iframe" onload="{2}();"></iframe>',self._iframeareaid,self.height-self._topheight-self._bottomheight,loadAction,self.url);var _bottomarea;if(self._bottomheight>0){_bottomarea=dom.create("div",{className:'bottombar',style:string.format("height:{0}px;",self._bottomheight)})}form.appendChild(_outerarea);_outerarea.appendChild(_frame);_outerarea.appendChild(_containsarea);_containsarea.innerHTML=strIframe;if(self._topheight){_containsarea.insertBefore(_toparea,_containsarea.lastChild)}_containsarea.insertBefore(_loadarea,_containsarea.lastChild);if(self._bottomheight>0){_containsarea.appendChild(_bottomarea)}document.body.appendChild(form);Frame.apply(self,{form:form,_frame:_frame,_loadarea:_loadarea,_containsarea:_containsarea,_toparea:_toparea,_bottomarea:_bottomarea})},showMask:function(s){var self=this;if(s){self.mask.style.display="block";if(Frame.isIE){document.getElementsByTagName("html")[0].style.overflow="hidden";document.getElementsByTagName("html")[0].style.paddingRight="17px"}else{document.body.style.overflow="hidden";document.body.style.paddingRight="16px"}if(Frame.isIE){self.mask.style.top=(document.documentElement.scrollTop||document.body.scrollTop)+"px"}}else{self.mask.style.display="none";if(Frame.isIE){document.getElementsByTagName("html")[0].style.overflow="";document.getElementsByTagName("html")[0].style.paddingRight=""}else{document.body.style.overflow="";document.body.style.paddingRight=""}}},showLoad:function(s){var self=this;if(s){self._loadarea.style.display="block";document.getElementById(self._iframeareaid).style.display="none"}else{self._loadarea.style.display="none";document.getElementById(self._iframeareaid).style.display="block"}},showForm:function(s){this.form.style.display=s?"block":"none"},setTitle:function(title){if(Frame.isEmpty(this._titleid))return false;this.title=title;document.getElementById(this._titleid).innerHTML=this.title},setUrl:function(url){if(Frame.isEmpty(document.getElementById(this._iframeareaid)))return false;document.getElementById(this._iframeareaid).src=url?url:this.url},show:function(title,url,width,height,closeable){if(Frame.isEmpty(this.mask)){this.createMask()}if(Frame.isEmpty(this.form)){this.createForm()}this.showLoad(true);if(!Frame.isEmpty(title)){this.title=title}this.setTitle(this.title);if(!Frame.isEmpty(url)){this.url=url}this.setUrl(this.url);if(Frame.isNumber(width)){this.minWidth=width}if(Frame.isNumber(height)){this.minHeight=height}this.closeable=closeable;if(dom.get(this.id+'_closebtn')){if(closeable){dom.get(this.id+'_closebtn').style.display=''}else{dom.get(this.id+'_closebtn').style.display='none'}}this.resize(0,0);this.showMask(true);this.showForm(true);this.center();this._isLogin=user.isLogin()},showDIV:function(){},hide:function(){this.showMask(false);this.showForm(false);if(this._isLogin===false&&user.isLogin()){this._isLogin=null;user.show(true)}},close:function(){document.body.removeChild(this.form);this.form=null;document.body.removeChild(this.mask);this.mask=null},move:function(top,left){this.top=top;this.left=left;this.form.style.top=this.top+"px";this.form.style.left=this.left+"px"},center:function(){this.form.style.margin=string.format("-{0}px 0px 0px -{1}px",this.height/ 2, this.width /2)},resize:function(width,height){var self=this;width=Math.max(self.minWidth,width);height=Math.max(self.minHeight,height);Frame.apply(self,{width:width,height:height});Frame.apply(self._frame.style,{width:self.width+'px',height:self.height+'px',padding:self._framepadding+"px"});Frame.apply(self._containsarea.style,{width:self.width+'px',height:self.height+'px',top:self._framepadding+'px',left:self._framepadding+'px'});Frame.apply(self._loadarea.style,{height:self.height-self._topheight-self._bottomheight+'px',lineHeight:self.height-self._topheight-self._bottomheight+'px'});document.getElementById(self._iframeareaid).style.height=self.height-self._topheight-self._bottomheight+"px"}});window.setbg=function(title,width,height,src,closeable){if(closeable=='false'||closeable==false)closeable=false;else closeable=true;win.getInstance().show(title,src,width,height,closeable)};window.closeopendiv=function(){win.getInstance().hide()}})})(this,this.document);﻿﻿(function(global,DOC,undefined){boot.declare('widgets.box','observable,dom,event',function(Namespace,Frame,observable,dom,event){Namespace.box=function(config){Frame.apply(this,config);this.init();Namespace.box.superclass.constructor.call(this)};Frame.extend(Namespace.box,observable,{id:null,rendered:false,hidden:true,disabled:false,container:null,title:"",__statuslist:[],status:null,el:null,items:null,init:function(){this.status={};this.getId();this.__extendFn("render");this.__extendFn("show");this.__extendFn("hide");this.__extendFn("enable");this.__extendFn("disable");this.__extendFn("destory");this.items={}},__extendFn:function(fn){if(typeof(fn)!="string"||Frame.isEmpty(fn))return false;fn=fn.toLowerCase();var camelCase=fn.substring(0,1).toUpperCase()+fn.substring(1).toLowerCase();var beforeEvent='onbefore'+fn;var onEvent='on'+fn;this.addEvents(beforeEvent,onEvent);var beforeFn='before'+camelCase;var Fn=fn;var onFn='on'+fn;var obj={};obj[beforeFn]=Frame.emptyFn;obj[Fn]=Frame.emptyFn;obj[onFn]=Frame.emptyFn;Frame.applyIf(this,obj)},__initStatus:function(sn,v){},getStatus:function(sn){},setStatus:function(sn,v){},getId:function(qualifier){if(qualifier){return this.getId().replace(/(\-\d+$)/,'-'+qualifier+'$1')}else{return this.id||(this.id=Frame.id("comp-"))}},render:function(container,position){if(!this.rendered&&this.fireEvent("beforerender",this)!==false){if(this.beforeRender)this.beforeRender();this.rendered=true;this.onRender(this.container,position||null);this.fireEvent("render",this);if(this.hidden){this.hide()}if(this.disabled){this.disable()}}return this},destory:function(){if(!this.rendered&&this.fireEvent("beforedestory",this)!==false){if(this.beforeDestory)this.beforeDestory();this.onDestory();this.fireEvent("destory",this)}return this},onDestory:function(){if(this.rendered){event.un(this.el,"");dom.remove(this.el)}this.purgeListeners()},show:function(){if(!this.rendered){this.render()}if(this.fireEvent("beforeshow",this)!==false){if(this.beforeShow)this.beforeShow();if(this.rendered){this.onShow();this.hidden=false;this.fireEvent("show",this)}}return this},onShow:function(){dom.show(this.el)},hide:function(){if(this.fireEvent("beforehide",this)!==false){if(this.beforeHide)this.beforeHide();if(this.rendered){this.onHide();this.hidden=true;this.fireEvent("hide",this)}}return this},onHide:function(){dom.hide(this.el)},isHidden:function(){return this.hidden===true},enable:function(){if(this.fireEvent("beforeenable",this)!==false){if(this.beforeEnable)this.beforeEnable();if(!this.disabled){this.onEnable();this.disabled=false;this.fireEvent("enable",this)}}return this},onEnable:function(){dom.enable(this.el)},disable:function(){if(this.fireEvent("beforedisable",this)!==false){if(this.beforeDisable)this.beforeDisable();if(this.disabled){this.onDisable();this.disabled=true;this.fireEvent("disable",this)}}return this},onDisable:function(){dom.disable(this.el)}})})})(this,this.document);﻿(function(global,DOC,undefined){boot.declare('util.offset','dom',function(Namespace,Frame,dom){Namespace.offset={scroll:function(x,y){if(Frame.isEmpty(x))x="";if(Frame.isEmpty(y))y="";x=x+"",y=y+"";var ix,iy,ox=this.getScrollLeft(),oy=this.getScrollTop();if(Frame.isEmpty(x))ix=ox;else if(x.substring(0,1)=="+")ix=ox+parseInt(x.substring(1));else if(x.substring(0,1)=="-")ix=ox-parseInt(x.substring(1));else ix=parseInt(x);if(Frame.isEmpty(y))iy=oy;else if(y.substring(0,1)=="+")iy=oy+parseInt(y.substring(1));else if(y.substring(0,1)=="-")iy=oy-parseInt(y.substring(1));else iy=parseInt(y);this.setScrollLeft(ix);this.setScrollTop(iy)},getScrollWidth:function(){return Math.max(document.documentElement.scrollWidth,document.body.scrollWidth)},getScrollHeight:function(){return Math.max(document.documentElement.scrollHeight,document.body.scrollHeight)},getClientWidth:function(){return DOC.documentElement.clientWidth==0?DOC.body.clientWidth:Math.min(DOC.body.clientWidth,DOC.documentElement.clientWidth)},getClientHeight:function(){return DOC.documentElement.clientHeight==0?DOC.body.clientHeight:Math.min(DOC.body.clientHeight,DOC.documentElement.clientHeight)},getScrollLeft:function(){return document.documentElement.scrollLeft+document.body.scrollLeft},getScrollTop:function(){return document.documentElement.scrollTop+document.body.scrollTop},setScrollLeft:function(l){document.documentElement.scrollLeft=l;document.body.scrollLeft=l},setScrollTop:function(t){document.documentElement.scrollTop=t;document.body.scrollTop=t},getXY:function(el){var element=dom.get(el);if(!element)return null;var left=0,top=0;while(element.offsetParent){left+=element.offsetLeft+(element.currentStyle?(parseInt(element.currentStyle.borderLeftWidth))||0:0);top+=element.offsetTop+(element.currentStyle?(parseInt(element.currentStyle.borderTopWidth))||0:0);element=element.offsetParent}left+=element.offsetLeft+(element.currentStyle?(parseInt(element.currentStyle.borderLeftWidth))||0:0);top+=element.offsetTop+(element.currentStyle?(parseInt(element.currentStyle.borderTopWidth))||0:0);return{x:left,y:top}},getHW:function(el){var element=dom.get(el);if(!element)return null;return{height:element.offsetHeight,width:element.offsetWidth}},getRect:function(el){var element=dom.get(el);if(!element)return null;var xy=this.getXY(element);var hw=this.getHW(element);return{top:xy.y,bottom:xy.y+hw.height,left:xy.x,right:xy.x+hw.width,height:hw.height,width:hw.width}},getEl:function(p,x,y){var cns=p.children,cnrs=[];var c=null;for(var i=0;i<cns.length;i++){var rect=this.getRect(cns[i]);var diffX=Math.abs(rect.left-x)<Math.abs(rect.right-x)?Math.abs(rect.left-x):Math.abs(rect.right-x);var diffY=Math.abs(rect.top-y)<Math.abs(rect.bottom-y)?Math.abs(rect.top-y):Math.abs(rect.bottom-y);cnrs.push({rect:rect,target:cns[i],diffX:diffX,diffY:diffY,diff:diffX+diffY});if(rect.top<=y&&y<=rect.bottom&&rect.left<=x&&x<=rect.right){c=cnrs[i];break}}if(!c){var minDiff=cnrs[0];for(var i=1;i<cnrs.length;i++){if(cnrs[i].diff<minDiff.diff){minDiff=cnrs[i]}}c=minDiff}if(!c){return null}else{return{target:c.target,point:(x<(c.rect.left+c.rect.right)/ 2 ? 'L' : 'R') + (y < (c.rect.top + c.rect.bottom) /2?'T':'B')}}}}})})(this,this.document);﻿(function(global,DOC,undefined){boot.declare('util.cookie','',function(Namespace,Frame){Namespace.cookie={get:function(name,encode){var arg=name+"=";var alen=arg.length;var clen=document.cookie.length;var i=0;var j=0;while(i<clen){j=i+alen;if(document.cookie.substring(i,j)==arg)return this.getCookieVal(j,encode);i=document.cookie.indexOf(" ",i)+1;if(i==0)break}return null},set:function(name,value,expires,path,domain,secure){var argv=arguments;var argc=arguments.length;var now=new Date();var expires=(argc>2)?argv[2]:new Date(now.getFullYear(),now.getMonth()+1,now.getUTCDate());var path=(argc>3)?argv[3]:'/';var domain=(argc>4)?argv[4]:'.flxxwang.com';var secure=(argc>5)?argv[5]:false;document.cookie=name+"="+escape(value)+((expires==null)?"":("; expires="+expires.toGMTString()))+((path==null)?"":("; path="+path))+((domain==null)?"":("; domain="+domain))+((secure==true)?"; secure":"")},remove:function(name){if(this.get(name))this.set(name,"",new Date(1970,1,1))},getCookieVal:function(offset,encode){var endstr=document.cookie.indexOf(";",offset);if(endstr==-1){endstr=document.cookie.length}if(encode==false)return document.cookie.substring(offset,endstr);else return unescape(document.cookie.substring(offset,endstr))}}})})(this,this.document);﻿(function(global,DOC,undefined){boot.declare('extension.string','',function(Namespace,Frame){Namespace.string={format:function(format){var args=Frame.toArray(arguments,1);return format.replace(/\{(\d+)\}/g,function(m,i){return args[i]})},trim:function(source){var re=/^\s+|\s+$/g;return source.replace(re,"")},leftPad:function(source,size,ch){var result=String(source);if(!ch){ch=" "}while(result.length<size){result=ch+result}return result},escape:function(string){return string.replace(/('|\\)/g,"\\$1")},substringEx:function(source,length){if(source.length*2<=length)return source;var index=0;for(var i=0,leni=source.length;i<leni;i++){if(source.charCodeAt(i)>128){index+=2}else{index++}if(index==length){return source.substring(0,i+1)}else if(index==length+1){return source.substring(0,i)}}return source},getLengthEx:function(source){var index=0;for(var i=0,leni=source.length;i<leni;i++){if(source.charCodeAt(i)>128){index+=2}else{index++}}return index},getShortText:function(source,length){if(length<3)return'...';return this.getLengthEx(source)>length?this.substringEx(source,length-3)+'...':source}}})})(this,this.document);﻿(function(global,DOC,undefined){boot.declare('observable','',function(Namespace,Frame){var __Event=function(obj,name){this.name=name;this.obj=obj;this.listeners=[]};__Event.prototype={addListener:function(fn,scope,options){var me=this,l;scope=scope||me.obj;if(!me.isListening(fn,scope)){l=me.createListener(fn,scope,options);if(me.firing){me.listeners=me.listeners.slice(0)}me.listeners.push(l)}},createListener:function(fn,scope,o){o=o||{};scope=scope||this.obj;var l={fn:fn,scope:scope,options:o},h=fn;if(o.target){h=createTargeted(h,o,scope)}if(o.delay){h=createDelayed(h,o,l,scope)}if(o.single){h=createSingle(h,this,fn,scope)}if(o.buffer){h=createBuffered(h,o,l,scope)}l.fireFn=h;return l},findListener:function(fn,scope){var list=this.listeners,i=list.length,l;scope=scope||this.obj;while(i--){l=list[i];if(l){if(l.fn==fn&&l.scope==scope){return i}}}return-1},isListening:function(fn,scope){return this.findListener(fn,scope)!=-1},removeListener:function(fn,scope){var index,l,k,me=this,ret=false;if((index=me.findListener(fn,scope))!=-1){if(me.firing){me.listeners=me.listeners.slice(0)}l=me.listeners[index];if(l.task){l.task.cancel();delete l.task}k=l.tasks&&l.tasks.length;if(k){while(k--){l.tasks[k].cancel()}delete l.tasks}me.listeners.splice(index,1);ret=true}return ret},clearListeners:function(){var me=this,l=me.listeners,i=l.length;while(i--){me.removeListener(l[i].fn,l[i].scope)}},fire:function(){var me=this,listeners=me.listeners,len=listeners.length,i=0,l;if(len>0){me.firing=true;var args=Array.prototype.slice.call(arguments,0);for(;i<len;i++){l=listeners[i];if(l&&l.fireFn.apply(l.scope||me.obj||window,args)===false){return(me.firing=false)}}}me.firing=false;return true}};Namespace.observable=function(){var me=this,e=me.events;if(me.listeners){me.on(me.listeners);delete me.listeners}me.events=e||{}};Namespace.observable.prototype={filterOptRe:/^(?:scope|delay|buffer|single)$/,fireEvent:function(){var a=Array.prototype.slice.call(arguments,0),ename=a[0].toLowerCase(),me=this,ret=true,ce=me.events[ename],cc,q,c;if(me.eventsSuspended===true){if(q=me.eventQueue){q.push(a)}}else if(typeof ce=='object'){if(ce.bubble){if(ce.fire.apply(ce,a.slice(1))===false){return false}c=me.getBubbleTarget&&me.getBubbleTarget();if(c&&c.enableBubble){cc=c.events[ename];if(!cc||typeof cc!='object'||!cc.bubble){c.enableBubble(ename)}return c.fireEvent.apply(c,a)}}else{a.shift();ret=ce.fire.apply(ce,a)}}return ret},addListener:function(eventName,fn,scope,o){var me=this,e,oe,ce;if(typeof eventName=='object'){o=eventName;for(e in o){oe=o[e];if(!me.filterOptRe.test(e)){me.addListener(e,oe.fn||oe,oe.scope||o.scope,oe.fn?oe:o)}}}else{eventName=eventName.toLowerCase();ce=me.events[eventName]||true;if(typeof ce=='boolean'){me.events[eventName]=ce=new __Event(me,eventName)}ce.addListener(fn,scope,typeof o=='object'?o:{})}},removeListener:function(eventName,fn,scope){var ce=this.events[eventName.toLowerCase()];if(typeof ce=='object'){if(fn&&typeof fn=='function'){ce.removeListener(fn,scope)}else{ce.clearListeners()}}},purgeListeners:function(){var events=this.events,evt,key;for(key in events){evt=events[key];if(typeof evt=='object'){evt.clearListeners()}}},addEvents:function(o){var me=this;me.events=me.events||{};if(typeof o=='string'){var a=arguments,i=a.length;while(i--){me.events[a[i]]=me.events[a[i]]||true}}else{Frame.applyIf(me.events,o)}},hasListener:function(eventName){var e=this.events[eventName.toLowerCase()];return typeof e=='object'&&e.listeners.length>0},suspendEvents:function(queueSuspended){this.eventsSuspended=true;if(queueSuspended&&!this.eventQueue){this.eventQueue=[]}},resumeEvents:function(){var me=this,queued=me.eventQueue||[];me.eventsSuspended=false;delete me.eventQueue;Frame.each(queued,function(e){me.fireEvent.apply(me,e)})}};Namespace.observable.prototype.on=Namespace.observable.prototype.addListener;Namespace.observable.prototype.un=Namespace.observable.prototype.removeListener})})(this,this.document);﻿(function(global,DOC,undefined){boot.declare('event','',function(Namespace,Frame){var getDom=function(id){if('string'==typeof id||id instanceof String){return document.getElementById(id)}else if(id&&id.nodeName&&(id.nodeType==1||id.nodeType==3||id.nodeType==9)){return id}return null};Namespace.event={getButton:function(event){if(Frame.isIE)button=(event.button<2)?"LEFT":((event.button==4)?"MIDDLE":"RIGHT");elsebutton=(event.which<2)?"LEFT":((event.which==2)?"MIDDLE":"RIGHT");return button},_listeners:[],_eventFilter:{},on:function(element,type,listener){element=getDom(element);if(!element)return;type=type.replace(/^on/i,'');var realListener=function(ev){listener.call(element,ev)},self=this,lis=self._listeners,filter=self._eventFilter,afterFilter,realType=type;type=type.toLowerCase();if(filter&&filter[type]){afterFilter=filter[type](element,type,realListener);realType=afterFilter.type;realListener=afterFilter.listener}if(element.addEventListener){element.addEventListener(realType,realListener,false)}else if(element.attachEvent){element.attachEvent('on'+realType,realListener)}lis[lis.length]=[element,type,listener,realListener,realType];return element},un:function(element,type,listener){element=getDom(element);if(!element)return;type=(type||"").replace(/^on/i,'').toLowerCase();var self=this,lis=self._listeners,len=lis.length,isRemoveAllTypes=!type,isRemoveAllListeners=!listener,item,realType,realListener;while(len--){item=lis[len];if((isRemoveAllTypes||item[1]===type)&&(item[0]===element)&&(isRemoveAllListeners||item[2]===listener)){realType=item[4];realListener=item[3];if(element.removeEventListener){element.removeEventListener(realType,realListener,false)}else if(element.detachEvent){element.detachEvent('on'+realType,realListener)}lis.splice(len,1)}}return element},once:function(element,type,listener){element=getDom(element);var self=this;function onceListener(event){listener.call(element,event);self.un(element,type,onceListener)}self.on(element,type,onceListener);return element},stop:function(event){var e=this;e.stopPropagation(event);e.preventDefault(event)},stopPropagation:function(event){if(event.stopPropagation){event.stopPropagation()}else{event.cancelBubble=true}},preventDefault:function(event){if(event.preventDefault){event.preventDefault()}else{event.returnValue=false}},get:function(event,win){return new this.EventArg(event,win)},getKeyCode:function(event){return event.which||event.keyCode},getPageX:function(event){var result=event.pageX,doc=document;if(!result&&result!==0){result=(event.clientX||0)+(doc.documentElement.scrollLeft||doc.body.scrollLeft)}return result},getPageY:function(event){var result=event.pageY,doc=document;if(!result&&result!==0){result=(event.clientY||0)+(doc.documentElement.scrollTop||doc.body.scrollTop)}return result},getTarget:function(event){return event.target||event.srcElement},EventArg:function(event,win){win=win||window;event=event||win.event;var doc=win.document;this.target=(event.target)||event.srcElement;this.keyCode=event.which||event.keyCode;for(var k in event){var item=event[k];if('function'!=typeof item){this[k]=item}}if(!this.pageX&&this.pageX!==0){this.pageX=(event.clientX||0)+(doc.documentElement.scrollLeft||doc.body.scrollLeft);this.pageY=(event.clientY||0)+(doc.documentElement.scrollTop||doc.body.scrollTop)}this._event=event},_unload:function(){var self=Namespace.event,lis=self._listeners,len=lis.length,standard=!!window.removeEventListener,item,el;while(len--){item=lis[len];if(item[1]=='unload'){continue}if(!(el=item[0])){continue}if(el.removeEventListener){el.removeEventListener(item[1],item[3],false)}else if(el.detachEvent){el.detachEvent('on'+item[1],item[3])}}if(standard){window.removeEventListener('unload',Frame.event._unload,false)}else{window.detachEvent('onunload',Frame.event._unload)}}};Namespace.event.EventArg.prototype.preventDefault=function(){if(this._event.preventDefault){this._event.preventDefault()}else{this._event.returnValue=false}return this};Namespace.event.EventArg.prototype.stopPropagation=function(){if(this._event.stopPropagation){this._event.stopPropagation()}else{this._event.cancelBubble=true}return this};Namespace.event.EventArg.prototype.stop=function(){return this.stopPropagation().preventDefault()};(function(){function extend(target,source){for(var p in source){if(source.hasOwnProperty(p)){target[p]=source[p]}}return target};function values(source){var result=[],resultLen=0,k;for(k in source){if(source.hasOwnProperty(k)){result[resultLen++]=source[k]}}return result};keys={keydown:1,keyup:1,keypress:1},mouses={click:1,dblclick:1,mousedown:1,mousemove:1,mouseup:1,mouseover:1,mouseout:1},htmls={abort:1,blur:1,change:1,error:1,focus:1,load:Frame.isIE?0:1,reset:1,resize:1,scroll:1,select:1,submit:1,unload:Frame.isIE?0:1},bubblesEvents={scroll:1,resize:1,reset:1,submit:1,change:1,select:1,error:1,abort:1},parameters={"KeyEvents":["bubbles","cancelable","view","ctrlKey","altKey","shiftKey","metaKey","keyCode","charCode"],"MouseEvents":["bubbles","cancelable","view","detail","screenX","screenY","clientX","clientY","ctrlKey","altKey","shiftKey","metaKey","button","relatedTarget"],"HTMLEvents":["bubbles","cancelable"],"UIEvents":["bubbles","cancelable","view","detail"],"Events":["bubbles","cancelable"]};extend(bubblesEvents,keys);extend(bubblesEvents,mouses);function parse(array,source){var i=0,size=array.length,obj={};for(;i<size;i++){obj[array[i]]=source[array[i]];delete source[array[i]]}return obj};function eventsHelper(type,eventType,options){options=extend({},options);var param=values(parse(parameters[eventType],options)),evnt=document.createEvent(eventType);param.unshift(type);if("KeyEvents"==eventType){evnt.initKeyEvent.apply(evnt,param)}else if("MouseEvents"==eventType){evnt.initMouseEvent.apply(evnt,param)}else if("UIEvents"==eventType){evnt.initUIEvent.apply(evnt,param)}else{evnt.initEvent.apply(evnt,param)}extend(evnt,options);return evnt};function eventObject(options){var evnt;if(document.createEventObject){evnt=document.createEventObject();extend(evnt,options)}return evnt};function keyEvents(type,options){options=parse(parameters["KeyEvents"],options);var evnt;if(document.createEvent){try{evnt=eventsHelper(type,"KeyEvents",options)}catch(keyError){try{evnt=eventsHelper(type,"Events",options)}catch(evtError){evnt=eventsHelper(type,"UIEvents",options)}}}else{options.keyCode=options.charCode>0?options.charCode:options.keyCode;evnt=eventObject(options)}return evnt};function mouseEvents(type,options){options=parse(parameters["MouseEvents"],options);var evnt;if(document.createEvent){evnt=eventsHelper(type,"MouseEvents",options);if(options.relatedTarget&&!evnt.relatedTarget){if("mouseout"==type.toLowerCase()){evnt.toElement=options.relatedTarget}else if("mouseover"==type.toLowerCase()){evnt.fromElement=options.relatedTarget}}}else{options.button=options.button==0?1:options.button==1?4:Frame.isNumber(options.button)?options.button:0;evnt=eventObject(options)}return evnt};function htmlEvents(type,options){options.bubbles=bubblesEvents.hasOwnProperty(type);options=parse(parameters["HTMLEvents"],options);var evnt;if(document.createEvent){try{evnt=eventsHelper(type,"HTMLEvents",options)}catch(htmlError){try{evnt=eventsHelper(type,"UIEvents",options)}catch(uiError){evnt=eventsHelper(type,"Events",options)}}}else{evnt=eventObject(options)}return evnt};Namespace.event.fire=function(element,type,options){var evnt;type=type.replace(/^on/i,"");element=getDom(element);options=extend({bubbles:true,cancelable:true,view:window,detail:1,screenX:0,screenY:0,clientX:0,clientY:0,ctrlKey:false,altKey:false,shiftKey:false,metaKey:false,keyCode:0,charCode:0,button:0,relatedTarget:null},options);if(keys[type]){evnt=keyEvents(type,options)}else if(mouses[type]){evnt=mouseEvents(type,options)}else if(htmls[type]){evnt=htmlEvents(type,options)}else{throw(new Error(type+" is not support!"))}if(evnt){if(element.dispatchEvent){element.dispatchEvent(evnt)}else if(element.fireEvent){element.fireEvent("on"+type,evnt)}}}})();if(window.attachEvent){window.attachEvent('onunload',Namespace.event._unload)}else{window.addEventListener('unload',Namespace.event._unload,false)}})})(this,this.document);﻿(function(global,DOC,undefined){boot.declare('dom','event',function(Frame,Namespace,event){var dom=Namespace.dom={_NAME_ATTRS:(function(){var result={'cellpadding':'cellPadding','cellspacing':'cellSpacing','colspan':'colSpan','rowspan':'rowSpan','valign':'vAlign','usemap':'useMap','frameborder':'frameBorder'};if(Frame.isIE&&!(Frame.isIE8)&&!(Frame.isIE9)){result['for']='htmlFor';result['class']='className'}else{result['htmlFor']='for';result['className']='class'}return result})(),create:function(tagName,options){Frame.log('log','create:argc='+arguments.length+';arg1='+arguments[0]+';arg2='+arguments[1]);if(arguments.length==1){var self=this,tempdiv=self.create('div',{html:tagName});return tempdiv.childNodes}else if(arguments.length==2){options=options||{};var el=document.createElement(tagName);return this.setAttr(el,options)}},clone:function(id){var el=this.get(id);if(Frame.isElement(el))return el.cloneNode(arguments[1]!==false);return null},remove:function(id){var el=this.get(id);if(el.parentNode){el.parentNode.removeChild(el)}},clear:function(id){var el=this.get(id);if(Frame.isElement(el)){el.innerHTML=""}},show:function(id){var el=this.get(id);if(Frame.isElement(el)&&el.style.display){el.style.display=""}},hide:function(id){var el=this.get(id);if(Frame.isElement(el)&&el.style.display!="none"){el.style.display="none"}},get:function(id){if('string'==typeof id||id instanceof String){return document.getElementById(id)}else if(id&&id.nodeName&&(id.nodeType==1||id.nodeType==9)){return id}return null},getText:function(id){var element=this.get(id);if(!element)return'';if(element.nodeType=='3'){return element.nodeValue}else if(element.childNodes){var childrens=element.childNodes,texts=[];for(var i=0,leni=childrens.length;i<leni;i++){texts.push(this.getText(childrens[i]))}return texts.join('')}var txt='',element=document.getElementsByTagName('div')[1],pos=element,i=0,count=element,stack=[element];while(i++<200){console.log(stack,pos);if(stack.length==0){break}if(pos==null){pos=stack.pop();if(pos.nextSibling){pos=pos.nextSibling;stack.push(pos)}else{if(pos.nodeType==3){txt+=pos.nodeValue}pos=null}}else{if(pos.firstChild){pos=pos.firstChild;stack.push(pos)}else if(pos.nextSibling){pos=pos.nextSibling;stack.push(pos)}else{if(pos.nodeType==3){txt+=pos.nodeValue}pos=null}}}},contain:function(p,c){var n=c;while(n&&n!=p)try{n=n.parentNode}catch(error){n=p}return n===p},getOuterHTML:function(el){var el=this.get(el);if(!el)return'';var div=this.create("DIV",{});div.appendChild(this.clone(el));return div.innerHTML},setAttr:function(element,key,value){Frame.log('log','setAttr:argc='+arguments.length+';arg1='+arguments[0]+';arg2='+arguments[1]+';arg3='+arguments[2]);if(arguments.length==3){element=this.get(element);if('style'==key){element.style.cssText=value}else if('html'==key){element.innerHTML=value}else if('listeners'==key){for(var eventName in value){event.on(element,eventName,value[eventName])}}else if('childrens'==key){for(var i=0,leni=value.length;i<leni;i++){if(Frame.isElement(value[i])){element.appendChild(value[i])}}}else{key=this._NAME_ATTRS[key]||key;element.setAttribute(key,value)}return element}else if(arguments.length==2){element=this.get(element);var attributes=arguments[1];for(var key in attributes){this.setAttr(element,key,attributes[key])}return element}}};var classHelper={addClass:function(element,className){element=this.get(element);if(!element)return;if(!this.hasClass(element,className)){element.className+=' '+className}},removeClass:function(element,className){element=this.get(element);if(!element)return;if(this.hasClass(element,className)){var reg=new RegExp('(\\s|^)'+className+'(\\s|$)');element.className=element.className.replace(reg,' ')}},hasClass:function(element,className){element=this.get(element);if(!element)return false;return-1<(" "+element.className+" ").indexOf(" "+className+" ")}};var domload={__scanList:[],__scanHandler:null,__scanInterval:500,__attachOnload:function(element,fn){if(Frame.isIE){element.attachEvent("onload",fn)}else{element.onload=fn}},__agency:function(o,element){var me=this;o.hosting=true;this.__attachOnload(element,function(){me.__call(o,element)})},__call:function(o,element){o.loaded=true;for(var i=0,leni=o.listeners.length;i<leni;i++){if(typeof o.listeners[i]=='function')o.listeners[i].call(element)}},__isLoaded:function(el){if(el){if(el.tagName&&el.tagName=='iframe'){try{if(el.contentWindow.document.readyState=='complete'){return true}}catch(e){};me.__agency(o,el);return false}else if(el.tagName&&el.tagName=='img'){if(el.readyState=='complete'||el.complete){return true}me.__agency(o,el);return false}else return true}else return false},onload:function(id,fn){for(var i=0,leni=this.__scanList.length;i<leni;i++){if(this.__scanList[i].id==id){if(this.__scanList[i].loaded==true){fn.call(this.get(id));return}else{this.__scanList[i].listeners.push(fn);return}}}this.__scanList.push({id:id,loaded:false,listeners:[fn],hosting:false});this.start()},start:function(){var me=this;if(!this.__scanHandler){this.__scanHandler=setInterval(function(){var c=0;for(var i=0,leni=me.__scanList.length;i<leni;i++){var o=me.__scanList[i];if(o.loaded||o.hosting){c++;continue}var el=me.get(o.id);if(me.__isLoaded(el)){me.__call(o,el)}}if(c==me.__scanList.length)me.stop()},this.__scanInterval)}},stop:function(){clearInterval(this.__scanHandler);this.__scanHandler=null}};Frame.apply(dom,classHelper);Frame.apply(dom,domload)})})(this,this.document);﻿(function(global,DOC,undefined){boot.require('business.user',function(Frame,user){
//Frame.init(function(){
//    user.containerid='login';
//    user.show()
//    })
}
);
})(this,this.document);